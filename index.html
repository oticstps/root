
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Data Produksi</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #dee2e6;
            --text-color: #212529;
            --text-muted: #6c757d;
        }
        .dark-mode {
            --primary-color: #3a86ff;
            --secondary-color: #adb5bd;
            --success-color: #06d6a0;
            --danger-color: #ef476f;
            --warning-color: #ffd166;
            --light-bg: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
            --text-color: #e0e0e0;
            --text-muted: #adb5bd;
            --table-header-bg: #2d2d2d;
            --table-row-even: #252525;
            --shift-separator: #333;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }
        /* Page Containers */
        .page {
            display: none;
            flex-direction: column;
            height: 100vh;
            width: 100%;
        }
        .page.active {
            display: flex;
        }
        /* Login Page */
        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            margin: auto;
        }
        .login-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        .app-logo {
            text-align: center;
            margin-bottom: 25px;
        }
        .app-logo i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 5px;
        }
        .app-subtitle {
            font-size: 0.95rem;
            color: var(--text-muted);
        }
        .form-label {
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
            color: var(--text-color);
        }
        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: 500;
            font-size: 1rem;
            margin-top: 10px;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .alert-danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        .footer-text {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        /* App Header */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .app-header-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .user-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .logout-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        /* Form Container */
        .form-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        /* Data Card */
        .data-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        .data-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .data-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        .data-date {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .data-label {
            color: var(--text-muted);
        }
        .data-value {
            font-weight: 500;
            color: var(--text-color);
        }
        /* Filter Section */
        .filter-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .month-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .month-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
        }
        .month-display {
            flex: 1;
            text-align: center;
            font-weight: 500;
            font-size: 1.1rem;
            color: var(--text-color);
        }
        .no-data {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }
        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }
        /* User Profile */
        .profile-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 15px;
        }
        .profile-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        .profile-email {
            color: var(--text-muted);
            margin-bottom: 20px;
        }
        .profile-info {
            text-align: left;
            margin-top: 20px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .info-label {
            color: var(--text-muted);
        }
        .info-value {
            font-weight: 500;
            color: var(--text-color);
        }
        /* Bottom Navigation */
        .bottom-nav {
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid var(--border-color);
            z-index: 1000;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: var(--primary-color);
        }
        .nav-item i {
            font-size: 1.25rem;
            margin-bottom: 4px;
        }
        /* Shift Info */
        .shift-info {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
            padding: 8px 12px;
            background-color: rgba(13, 110, 253, 0.05);
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
        }
        /* Loading Spinner */
        .spinner-border {
            width: 1rem;
            height: 1rem;
            border-width: 0.15em;
        }
        .d-none {
            display: none;
        }
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-edit {
            background-color: var(--warning-color);
            border: none;
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
        }
        .btn-delete {
            background-color: var(--danger-color);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
        }
        /* Modal */
        .modal-content {
            border-radius: 12px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .modal-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        .modal-footer {
            padding: 10px 15px;
            border-top: 1px solid var(--border-color);
        }
        /* Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .dashboard-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color);
        }
        .dashboard-date-range {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .summary-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        .summary-card-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .summary-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        .line-monitoring-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }
        .line-monitoring-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        .line-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            min-width: 600px;
        }
        .line-table th,
        .line-table td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }
        .line-table th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            position: sticky;
            top: 0;
            color: var(--text-color);
        }
        .line-table td {
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .line-table tr:nth-child(even) td {
            background-color: var(--table-row-even);
        }
        /* Custom Alert Styles */
        .custom-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .custom-alert-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .custom-alert {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
            color: var(--text-color);
        }
        .custom-alert-overlay.show .custom-alert {
            transform: translateY(0);
        }
        .custom-alert-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .custom-alert-title {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .custom-alert-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
        }
        .custom-alert-body {
            padding: 20px;
        }
        .custom-alert-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .custom-alert-btn {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        .custom-alert-btn-confirm {
            background-color: var(--primary-color);
            color: white;
        }
        .custom-alert-btn-cancel {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        /* Shift separation styles */
        .shift-separator {
            background-color: var(--shift-separator) !important;
            font-weight: bold;
        }
        /* Filter Section Styling */
        .filter-section .form-label {
            font-size: 0.75rem;
            margin-bottom: 3px;
            color: var(--text-muted);
        }
        .filter-section .form-select {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        .filter-section .btn {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        /* Access Control */
        .access-control-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .access-control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .access-control-item:last-child {
            border-bottom: none;
        }
        .access-control-label {
            font-weight: 500;
            color: var(--text-color);
        }
        .access-control-value {
            color: var(--text-muted);
        }
        /* Settings Section */
        .settings-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .settings-item:last-child {
            border-bottom: none;
        }
        .settings-label {
            font-weight: 500;
            color: var(--text-color);
        }
        .settings-value {
            color: var(--text-muted);
        }
        /* Auto Logout Warning */
        .auto-logout-warning {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1500;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 90%;
            width: 350px;
        }
        .auto-logout-warning.hidden {
            display: none;
        }
        .auto-logout-timer {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }
        .auto-logout-buttons {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }
        .auto-logout-btn {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .auto-logout-stay {
            background-color: var(--primary-color);
            color: white;
        }
        .auto-logout-logout {
            background-color: var(--danger-color);
            color: white;
        }
        /* Refresh Loading Popup */
        #refreshLoadingPopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2500;
        }
        #refreshLoadingPopup.show {
            display: flex;
        }
        .refresh-loading-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            color: var(--text-color);
        }
        /* Line Access Selection */
        .line-access-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .line-access-item {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            background-color: var(--table-row-even);
            border-radius: 5px;
            font-size: 0.85rem;
        }
        .line-access-item .form-check {
            margin-bottom: 0;
        }
        .line-access-item .form-check-input {
            margin-top: 0;
            margin-right: 5px;
        }
        /* Form Switch Dark Mode */
        .form-switch .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        /* Button Styles */
        .btn-outline-secondary {
            border-color: var(--border-color);
            color: var(--text-color);
        }
        .btn-outline-secondary:hover {
            background-color: var(--table-row-even);
        }
        /* Table Header Sub-headers */
        .line-table th[colspan="2"] {
            background-color: var(--table-header-bg);
        }
        /* Responsive adjustments */
        @media (max-width: 576px) {
            .line-table {
                font-size: 0.75rem;
            }
            .line-table th,
            .line-table td {
                padding: 6px 4px;
            }
            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        /* Dashboard Selection */
        .dashboard-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
        }
        .dashboard-selection-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: var(--text-color);
        }
        .dashboard-selection-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 300px;
        }
        .dashboard-selection-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        .dashboard-selection-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .dashboard-selection-btn i {
            font-size: 1.5rem;
        }
        /* Dashboard Content */
        .dashboard-content {
            display: none;
        }
        .dashboard-content.active {
            display: block;
        }
        /* KPP Dashboard Styles */
        .kpp-dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .kpp-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .kpp-summary-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        .kpp-summary-card-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .kpp-summary-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger-color);
        }
        .kpp-ng-table-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }
        .kpp-ng-table-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        .kpp-ng-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            min-width: 600px;
        }
        .kpp-ng-table th,
        .kpp-ng-table td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }
        .kpp-ng-table th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            position: sticky;
            top: 0;
            color: var(--text-color);
        }
        .kpp-ng-table td {
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .kpp-ng-table tr:nth-child(even) td {
            background-color: var(--table-row-even);
        }
        /* KPP Data List */
        .kpp-data-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .kpp-data-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        .kpp-data-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .kpp-data-title {
            font-weight: 600;
            color: var(--danger-color);
        }
        .kpp-data-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .kpp-data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        .kpp-data-label {
            color: var(--text-muted);
        }
        .kpp-data-value {
            font-weight: 500;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <!-- Refresh Loading Popup -->
    <div id="refreshLoadingPopup" class="show">
        <div class="refresh-loading-content">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem; margin-bottom: 15px;">
                <span class="visually-hidden">Memuat...</span>
            </div>
            <div style="font-size: 1.1rem; font-weight: 500;">Memuat Data...</div>
        </div>
    </div>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="app-logo">
                    <img src="assets/otics.png" alt="Logo" style="width: 100px; height: 100px;" />
                    <h1 class="app-title">KANRIBAN PRODUKSI</h1>
                    <p class="app-subtitle">Silakan login untuk melanjutkan</p>
                </div>
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="email" class="form-label">Username</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                        <span id="loginText">Login</span>
                        <span id="loginSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </form>
                <div id="loginStatus" class="status-message mt-3 d-none"></div>
                <div class="footer-text">
                    Â© 2025 Data Produksi | v1.0
                </div>
            </div>
        </div>
    </div>
    <!-- Home Page -->
    <div id="homePage" class="page">
        <!-- App Header -->
        <header class="app-header">
            <div class="app-header-title">Otics Dashboard Produksi</div>
            <div class="user-section">
                <div class="user-avatar" id="homeUserAvatar">U</div>
                <button class="logout-btn" id="homeLogoutBtn">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </header>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Selection -->
            <div id="dashboardSelection" class="dashboard-selection">
                <h2 class="dashboard-selection-title">Pilih Dashboard</h2>
                <div class="dashboard-selection-buttons">
                    <a href="#" id="manhourDashboardBtn" class="dashboard-selection-btn">
                        <i class="bi bi-bar-chart-line"></i>
                        <span>Dashboard Manhour (Hasil Produksi)</span>
                    </a>
                    <a href="#" id="kppDashboardBtn" class="dashboard-selection-btn">
                        <i class="bi bi-clipboard-check"></i>
                        <span>Menu KPP (Pencatatan NG)</span>
                    </a>
                </div>
            </div>
            <!-- Manhour Dashboard Content -->
            <div id="manhourDashboard" class="dashboard-content">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <div class="dashboard-title">Ringkasan Produksi</div>
                    <div class="dashboard-date-range" id="dashboardDateRange">1 - 31 Januari 2023</div>
                </div>
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-card-title">Total Produksi</div>
                        <div class="summary-card-value" id="totalProduction">0</div>
                        <div class="summary-card-title">pcs</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-card-title">Total Loading Time</div>
                        <div class="summary-card-value" id="totalLoadingTime">0</div>
                        <div class="summary-card-title">menit</div>
                    </div>
                </div>
                <!-- Filter Section -->
                <section class="filter-section">
                    <h2 class="section-title">Filter Data</h2>
                    <div class="month-selector">
                        <button class="month-btn" id="prevMonth">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <div class="month-display" id="currentMonth">Januari 2023</div>
                        <button class="month-btn" id="nextMonth">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </section>
                <!-- Line Monitoring Section -->
                <section class="line-monitoring-section">
                    <h2 class="line-monitoring-title">Monitoring Line Produksi</h2>
                    <div style="overflow-x: auto;">
                        <table class="line-table">
                            <thead id="tableHeader">
                                <!-- Header will be generated dynamically -->
                            </thead>
                            <tbody id="lineTableBody">
                                <!-- Data rows will be generated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </section>
                <!-- Data List Section -->
                <section class="data-section">
                    <h2 class="section-title">Data Produksi Terbaru</h2>
                    <!-- Filter Section untuk Data Terbaru -->
                    <div class="filter-section mb-3">
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <label for="filterLine" class="form-label">Line Produksi</label>
                                <select class="form-select form-select-sm" id="filterLine">
                                    <option value="">Semua Line</option>
                                    <option value="COMMON RAIL 01">COMMON RAIL 01</option>
                                    <option value="COMMON RAIL 02">COMMON RAIL 02</option>
                                    <option value="COMMON RAIL 03">COMMON RAIL 03</option>
                                    <option value="COMMON RAIL 04">COMMON RAIL 04</option>
                                    <option value="COMMON RAIL 05">COMMON RAIL 05</option>
                                    <option value="COMMON RAIL 06">COMMON RAIL 06</option>
                                    <option value="COMMON RAIL 07">COMMON RAIL 07</option>
                                    <option value="COMMON RAIL 08">COMMON RAIL 08</option>
                                    <option value="COMMON RAIL 09">COMMON RAIL 09</option>
                                    <option value="COMMON RAIL 10">COMMON RAIL 10</option>
                                    <option value="COMMON RAIL 11">COMMON RAIL 11</option>
                                    <option value="COMMON RAIL 12">COMMON RAIL 12</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-3">
                                <label for="filterPart" class="form-label">Part</label>
                                <select class="form-select form-select-sm" id="filterPart">
                                    <option value="">Semua Part</option>
                                    <!-- Options akan diisi secara dinamis berdasarkan line yang dipilih -->
                                </select>
                            </div>
                            <div class="col-6 col-md-2">
                                <label for="filterGroup" class="form-label">Group</label>
                                <select class="form-select form-select-sm" id="filterGroup">
                                    <option value="">Semua Group</option>
                                    <option value="PG-1">PG-1</option>
                                    <option value="PG-2.1">PG-2.1</option>
                                    <option value="PG-2.2">PG-2.2</option>
                                    <option value="PG-2.3">PG-2.3</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-2">
                                <label for="filterShift" class="form-label">Shift</label>
                                <select class="form-select form-select-sm" id="filterShift">
                                    <option value="">Semua Shift</option>
                                    <option value="1">Shift 1</option>
                                    <option value="2">Shift 2</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-2 d-flex align-items-end">
                                <button class="btn btn-outline-secondary w-100" id="resetFilterBtn">
                                    <i class="bi bi-x-circle"></i> Reset
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="dataContainer">
                        <div class="no-data" id="noDataMessage">
                            <i class="bi bi-clipboard-data"></i>
                            <p>Tidak ada data produksi</p>
                            <small>Silakan input data terlebih dahulu</small>
                        </div>
                    </div>
                </section>
            </div>
            <!-- KPP Dashboard Content -->
            <div id="kppDashboard" class="dashboard-content">
                <!-- KPP Dashboard Header -->
                <div class="kpp-dashboard-header">
                    <div class="dashboard-title">Ringkasan KPP (NG)</div>
                    <div class="dashboard-date-range" id="kppDashboardDateRange">1 - 31 Januari 2023</div>
                </div>
                <!-- KPP Summary Cards -->
                <div class="kpp-summary-cards">
                    <div class="kpp-summary-card">
                        <div class="kpp-summary-card-title">Total NG</div>
                        <div class="kpp-summary-card-value" id="totalNG">0</div>
                        <div class="kpp-summary-card-title">pcs</div>
                    </div>
                    <div class="kpp-summary-card">
                        <div class="kpp-summary-card-title">Total Item NG</div>
                        <div class="kpp-summary-card-value" id="totalItemNG">0</div>
                        <div class="kpp-summary-card-title">item</div>
                    </div>
                </div>
                <!-- Filter Section for KPP -->
                <section class="filter-section">
                    <h2 class="section-title">Filter Data KPP</h2>
                    <div class="month-selector">
                        <button class="month-btn" id="kppPrevMonth">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <div class="month-display" id="kppCurrentMonth">Januari 2023</div>
                        <button class="month-btn" id="kppNextMonth">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </section>
                <!-- NG Monitoring Section -->
                <section class="kpp-ng-table-section">
                    <h2 class="kpp-ng-table-title">Monitoring NG per Line</h2>
                    <div style="overflow-x: auto;">
                        <table class="kpp-ng-table">
                            <thead id="kppTableHeader">
                                <!-- Header will be generated dynamically -->
                            </thead>
                            <tbody id="kppTableBody">
                                <!-- Data rows will be generated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </section>
                <!-- KPP Data List Section -->
                <section class="kpp-data-section">
                    <h2 class="section-title">Data KPP Terbaru</h2>
                    <!-- Filter Section untuk Data KPP Terbaru -->
                    <div class="filter-section mb-3">
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <label for="kppFilterLine" class="form-label">Line Produksi</label>
                                <select class="form-select form-select-sm" id="kppFilterLine">
                                    <option value="">Semua Line</option>
                                    <option value="COMMON RAIL 01">COMMON RAIL 01</option>
                                    <option value="COMMON RAIL 02">COMMON RAIL 02</option>
                                    <option value="COMMON RAIL 03">COMMON RAIL 03</option>
                                    <option value="COMMON RAIL 04">COMMON RAIL 04</option>
                                    <option value="COMMON RAIL 05">COMMON RAIL 05</option>
                                    <option value="COMMON RAIL 06">COMMON RAIL 06</option>
                                    <option value="COMMON RAIL 07">COMMON RAIL 07</option>
                                    <option value="COMMON RAIL 08">COMMON RAIL 08</option>
                                    <option value="COMMON RAIL 09">COMMON RAIL 09</option>
                                    <option value="COMMON RAIL 10">COMMON RAIL 10</option>
                                    <option value="COMMON RAIL 11">COMMON RAIL 11</option>
                                    <option value="COMMON RAIL 12">COMMON RAIL 12</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-3">
                                <label for="kppFilterPart" class="form-label">Part</label>
                                <select class="form-select form-select-sm" id="kppFilterPart">
                                    <option value="">Semua Part</option>
                                    <!-- Options akan diisi secara dinamis -->
                                </select>
                            </div>
                            <div class="col-6 col-md-3">
                                <label for="kppFilterProses" class="form-label">Proses (#)</label>
                                <select class="form-select form-select-sm" id="kppFilterProses">
                                    <option value="">Semua Proses</option>
                                    <option value="#10">#10</option>
                                    <option value="#20">#20</option>
                                    <option value="#30">#30</option>
                                    <option value="#70">#70</option>
                                    <option value="#80">#80</option>
                                    <option value="#120">#120</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-3 d-flex align-items-end">
                                <button class="btn btn-outline-secondary w-100" id="kppResetFilterBtn">
                                    <i class="bi bi-x-circle"></i> Reset
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="kppDataContainer">
                        <div class="no-data" id="kppNoDataMessage">
                            <i class="bi bi-clipboard-x"></i>
                            <p>Tidak ada data KPP</p>
                            <small>Silakan input data KPP terlebih dahulu</small>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="homeNav">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" id="inputNav">
                <i class="bi bi-plus-circle"></i>
                <span>Input</span>
            </a>
            <a href="#" class="nav-item" id="kppNav">
                <i class="bi bi-clipboard-check"></i>
                <span>KPP</span>
            </a>
            <a href="#" class="nav-item" id="profileNav">
                <i class="bi bi-person"></i>
                <span>Profil</span>
            </a>
            <a href="#" class="nav-item" id="settingsNav">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>
    <!-- Input/Edit Page -->
    <div id="inputPage" class="page">
        <!-- App Header -->
        <header class="app-header">
            <div class="app-header-title" id="inputPageTitle">Input Data</div>
            <div class="user-section">
                <div class="user-avatar" id="inputUserAvatar">U</div>
                <button class="logout-btn" id="inputLogoutBtn">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </header>
        <!-- Main Content -->
        <main class="main-content">
            <section class="input-section">
                <h2 class="section-title" id="formTitle">Input Data Produksi</h2>
                <div class="form-container">
                    <form id="productionForm">
                        <input type="hidden" id="documentId">
                        <div class="mb-3">
                            <label for="namaLineProduksi" class="form-label">Nama Line Produksi</label>
                            <select class="form-select" id="namaLineProduksi" required>
                                <option value="" selected disabled>Pilih Line Produksi</option>
                                <option value="COMMON RAIL 01">COMMON RAIL 01</option>
                                <option value="COMMON RAIL 02">COMMON RAIL 02</option>
                                <option value="COMMON RAIL 03">COMMON RAIL 03</option>
                                <option value="COMMON RAIL 04">COMMON RAIL 04</option>
                                <option value="COMMON RAIL 05">COMMON RAIL 05</option>
                                <option value="COMMON RAIL 06">COMMON RAIL 06</option>
                                <option value="COMMON RAIL 07">COMMON RAIL 07</option>
                                <option value="COMMON RAIL 08">COMMON RAIL 08</option>
                                <option value="COMMON RAIL 09">COMMON RAIL 09</option>
                                <option value="COMMON RAIL 10">COMMON RAIL 10</option>
                                <option value="COMMON RAIL 11">COMMON RAIL 11</option>
                                <option value="COMMON RAIL 12">COMMON RAIL 12</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="namaPart" class="form-label">Nama Part</label>
                            <select class="form-select" id="namaPart" required disabled>
                                <option value="" selected disabled>Pilih Line Produksi Terlebih Dahulu</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="tanggal" class="form-label">Tanggal</label>
                            <input type="date" class="form-control" id="tanggal" required>
                        </div>
                        <div class="mb-3">
                            <label for="group" class="form-label">Group</label>
                            <select class="form-select" id="group" required>
                                <option value="" selected disabled>Pilih Group</option>
                                <option value="PG-1">PG-1</option>
                                <option value="PG-2.1">PG-2.1</option>
                                <option value="PG-2.2">PG-2.2</option>
                                <option value="PG-2.3">PG-2.3</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="shift" class="form-label">Shift</label>
                            <select class="form-select" id="shift" required>
                                <option value="" selected disabled>Pilih Shift</option>
                                <option value="1">Shift 1</option>
                                <option value="2">Shift 2</option>
                            </select>
                            <div id="shiftInfo" class="shift-info mt-2 d-none"></div>
                        </div>
                        <div class="mb-3">
                            <label for="sigmaProduksi" class="form-label">Total Produksi</label>
                            <input type="number" step="any" class="form-control" id="sigmaProduksi" required>
                        </div>
                        <div class="mb-3">
                            <label for="sigmaOP" class="form-label">Total OP</label>
                            <input type="number" step="any" class="form-control" id="sigmaOP" required>
                        </div>
                        <div class="mb-3">
                            <label for="loadingTime" class="form-label">Loading Time (menit)</label>
                            <input type="number" step="any" class="form-control" id="loadingTime" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="submitBtn">
                            <span id="submitText">Simpan Data</span>
                            <span id="submitSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </form>
                    <div id="inputStatusMessage" class="status-message mt-3 d-none"></div>
                </div>
            </section>
        </main>
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item" id="homeNav2">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item active" id="inputNav2">
                <i class="bi bi-plus-circle"></i>
                <span>Input</span>
            </a>
            <a href="#" class="nav-item" id="kppNav2">
                <i class="bi bi-clipboard-check"></i>
                <span>KPP</span>
            </a>
            <a href="#" class="nav-item" id="profileNav2">
                <i class="bi bi-person"></i>
                <span>Profil</span>
            </a>
            <a href="#" class="nav-item" id="settingsNav2">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>
    <!-- KPP Page -->
    <div id="kppPage" class="page">
        <!-- App Header -->
        <header class="app-header">
            <div class="app-header-title">Input Data KPP</div>
            <div class="user-section">
                <div class="user-avatar" id="kppUserAvatar">U</div>
                <button class="logout-btn" id="kppLogoutBtn">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </header>
        <!-- Main Content -->
        <main class="main-content">
            <section class="input-section">
                <h2 class="section-title">Input Data NG KPP</h2>
                <div class="form-container">
                    <form id="kppForm">
                        <input type="hidden" id="kppDocumentId"> <!-- Untuk edit -->
                        <div class="mb-3">
                            <label for="kppLineProduksi" class="form-label">Line Produksi</label>
                            <select class="form-select" id="kppLineProduksi" required>
                                <option value="" selected disabled>Pilih Line Produksi</option>
                                <option value="COMMON RAIL 01">COMMON RAIL 01</option>
                                <option value="COMMON RAIL 02">COMMON RAIL 02</option>
                                <option value="COMMON RAIL 03">COMMON RAIL 03</option>
                                <option value="COMMON RAIL 04">COMMON RAIL 04</option>
                                <option value="COMMON RAIL 05">COMMON RAIL 05</option>
                                <option value="COMMON RAIL 06">COMMON RAIL 06</option>
                                <option value="COMMON RAIL 07">COMMON RAIL 07</option>
                                <option value="COMMON RAIL 08">COMMON RAIL 08</option>
                                <option value="COMMON RAIL 09">COMMON RAIL 09</option>
                                <option value="COMMON RAIL 10">COMMON RAIL 10</option>
                                <option value="COMMON RAIL 11">COMMON RAIL 11</option>
                                <option value="COMMON RAIL 12">COMMON RAIL 12</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="kppPart" class="form-label">Part</label>
                            <select class="form-select" id="kppPart" required disabled>
                                <option value="" selected disabled>Pilih Line Terlebih Dahulu</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="kppTanggal" class="form-label">Tanggal</label>
                            <input type="date" class="form-control" id="kppTanggal" required>
                        </div>
                        <div class="mb-3">
                            <label for="kppProses" class="form-label">Proses (#)</label>
                            <select class="form-select" id="kppProses" required disabled>
                                <option value="" selected disabled>Pilih Part Terlebih Dahulu</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="kppItemNG" class="form-label">Item NG</label>
                            <select class="form-select" id="kppItemNG" required disabled>
                                <option value="" selected disabled>Pilih Proses Terlebih Dahulu</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="kppJumlahNG" class="form-label">Jumlah NG</label>
                            <input type="number" class="form-control" id="kppJumlahNG" min="1" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="kppSubmitBtn">
                            <span id="kppSubmitText">Simpan Data KPP</span>
                            <span id="kppSubmitSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </form>
                    <div id="kppStatusMessage" class="status-message mt-3 d-none"></div>
                </div>
            </section>
        </main>
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item" id="homeNavKpp">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" id="inputNavKpp">
                <i class="bi bi-plus-circle"></i>
                <span>Input</span>
            </a>
            <a href="#" class="nav-item active" id="kppNavKpp"> <!-- Active by default -->
                <i class="bi bi-clipboard-check"></i>
                <span>KPP</span>
            </a>
            <a href="#" class="nav-item" id="profileNavKpp">
                <i class="bi bi-person"></i>
                <span>Profil</span>
            </a>
            <a href="#" class="nav-item" id="settingsNavKpp">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>
    <!-- Profile Page -->
    <div id="profilePage" class="page">
        <!-- App Header -->
        <header class="app-header">
            <div class="app-header-title">Profil Pengguna</div>
            <div class="user-section">
                <div class="user-avatar" id="profileUserAvatar">U</div>
                <button class="logout-btn" id="profileLogoutBtn">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </header>
        <!-- Main Content -->
        <main class="main-content">
            <section class="profile-section">
                <div class="profile-card">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <h3 class="profile-name" id="profileName">Nama Pengguna</h3>
                    <div class="profile-email" id="profileEmail">email@contoh.com</div>
                    <div class="profile-info">
                        <div class="info-item">
                            <span class="info-label">Metode Login</span>
                            <span class="info-value" id="loginMethod">Username</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Tanggal Bergabung</span>
                            <span class="info-value" id="joinDate">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">UID</span>
                            <span class="info-value" id="userUid">-</span>
                        </div>
                    </div>
                    <button id="profileLogoutBtn2" class="btn btn-outline-danger w-100 mt-4">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </button>
                </div>
            </section>
        </main>
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item" id="homeNav3">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" id="inputNav3">
                <i class="bi bi-plus-circle"></i>
                <span>Input</span>
            </a>
            <a href="#" class="nav-item" id="kppNav3">
                <i class="bi bi-clipboard-check"></i>
                <span>KPP</span>
            </a>
            <a href="#" class="nav-item active" id="profileNav3">
                <i class="bi bi-person"></i>
                <span>Profil</span>
            </a>
            <a href="#" class="nav-item" id="settingsNav3">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>


    
    <!-- Settings Page -->
    <div id="settingsPage" class="page">
        <!-- App Header -->
        <header class="app-header">
            <div class="app-header-title">Pengaturan</div>
            <div class="user-section">
                <div class="user-avatar" id="settingsUserAvatar">U</div>
                <button class="logout-btn" id="settingsLogoutBtn">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </header>
        <!-- Main Content -->
        <main class="main-content">
            <section class="settings-section">
                <h2 class="section-title">Tampilan</h2>
                <div class="settings-item">
                    <span class="settings-label">Mode Gelap</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                        <label class="form-check-label" for="darkModeToggle"></label>
                    </div>
                </div>
            </section>
            <section class="settings-section">
                <h2 class="section-title">Keamanan</h2>
                <div class="settings-item">
                    <span class="settings-label">Waktu Logout Otomatis</span>
                    <select class="form-select form-select-sm" id="autoLogoutTime" style="width: auto;">
                        <option value="15">15 menit</option>
                        <option value="30" selected>30 menit</option>
                        <option value="45">45 menit</option>
                        <option value="60">1 jam</option>
                    </select>
                </div>
            </section>
            <section class="access-control-section">
                <h2 class="section-title">Hak Akses Pengguna</h2>
                <div class="access-control-item">
                    <span class="access-control-label">Line Produksi yang Dapat Diakses</span>
                    <div class="line-access-container" id="lineAccessContainer">
                        <!-- Line access checkboxes will be generated here -->
                    </div>
                </div>
                <div class="access-control-item">
                    <span class="access-control-label">Hak Input Data</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="inputPermissionToggle">
                        <label class="form-check-label" for="inputPermissionToggle"></label>
                    </div>
                </div>
                <div class="access-control-item">
                    <span class="access-control-label">Hak Edit/Hapus Data</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="editPermissionToggle">
                        <label class="form-check-label" for="editPermissionToggle"></label>
                    </div>
                </div>
                <div class="access-control-item">
                    <button class="btn btn-primary" id="savePermissionsBtn">Simpan Hak Akses</button>
                </div>
            </section>
            <section class="settings-section">
                <h2 class="section-title">Tentang</h2>
                <div class="settings-item">
                    <span class="settings-label">Versi Aplikasi</span>
                    <span class="settings-value">v1.0</span>
                </div>
                <div class="settings-item">
                    <span class="settings-label">Tahun</span>
                    <span class="settings-value">2025</span>
                </div>
            </section>
        </main>
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item" id="homeNav4">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" id="inputNav4">
                <i class="bi bi-plus-circle"></i>
                <span>Input</span>
            </a>
            <a href="#" class="nav-item" id="kppNav4">
                <i class="bi bi-clipboard-check"></i>
                <span>KPP</span>
            </a>
            <a href="#" class="nav-item" id="profileNav4">
                <i class="bi bi-person"></i>
                <span>Profil</span>
            </a>
            <a href="#" class="nav-item active" id="settingsNav4">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Konfirmasi Hapus</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Apakah Anda yakin ingin menghapus data ini?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Custom Alert -->
    <div class="custom-alert-overlay" id="customAlert">
        <div class="custom-alert">
            <div class="custom-alert-header">
                <div class="custom-alert-title" id="alertTitle">Konfirmasi</div>
                <button class="custom-alert-close">&times;</button>
            </div>
            <div class="custom-alert-body" id="alertMessage">
                Apakah Anda yakin ingin melanjutkan?
            </div>
            <div class="custom-alert-footer">
                <button class="custom-alert-btn custom-alert-btn-cancel" id="alertCancelBtn">Batal</button>
                <button class="custom-alert-btn custom-alert-btn-confirm" id="alertConfirmBtn">OK</button>
            </div>
        </div>
    </div>
    <!-- Auto Logout Warning -->
    <div class="auto-logout-warning hidden" id="autoLogoutWarning">
        <i class="bi bi-clock-history"></i>
        <span>Sesi akan berakhir dalam <span class="auto-logout-timer" id="autoLogoutTimer">00:00</span></span>
        <div class="auto-logout-buttons">
            <button class="auto-logout-btn auto-logout-stay" id="stayLoggedInBtn">Tetap Login</button>
            <button class="auto-logout-btn auto-logout-logout" id="logoutNowBtn">Logout</button>
        </div>
    </div>
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, updateDoc, deleteDoc, query, where, orderBy, setDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAEAmmyJxMriLaNBA4n8xEXtu1g91uv860",
            authDomain: "coreengine-142ea.firebaseapp.com",
            databaseURL: "https://coreengine-142ea-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "coreengine-142ea",
            storageBucket: "coreengine-142ea.firebasestorage.app",
            messagingSenderId: "890812454910",
            appId: "1:890812454910:web:d0906c637e26017df052af",
            measurementId: "G-3C9ZF4EXVM"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        // Initialize Firebase services
        const db = getFirestore(app);
        const auth = getAuth(app);
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const homePage = document.getElementById('homePage');
        const inputPage = document.getElementById('inputPage');
        const kppPage = document.getElementById('kppPage');
        const profilePage = document.getElementById('profilePage');
        const settingsPage = document.getElementById('settingsPage');
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        // Custom Alert Elements
        const customAlert = document.getElementById('customAlert');
        const alertTitle = document.getElementById('alertTitle');
        const alertMessage = document.getElementById('alertMessage');
        const alertConfirmBtn = document.getElementById('alertConfirmBtn');
        const alertCancelBtn = document.getElementById('alertCancelBtn');
        const alertCloseBtn = document.querySelector('.custom-alert-close');
        // Login Page Elements
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const loginText = document.getElementById('loginText');
        const loginSpinner = document.getElementById('loginSpinner');
        const loginStatus = document.getElementById('loginStatus');
        // Home Page Elements
        const homeUserAvatar = document.getElementById('homeUserAvatar');
        const homeLogoutBtn = document.getElementById('homeLogoutBtn');
        const dataContainer = document.getElementById('dataContainer');
        const noDataMessage = document.getElementById('noDataMessage');
        const currentMonth = document.getElementById('currentMonth');
        const prevMonth = document.getElementById('prevMonth');
        const nextMonth = document.getElementById('nextMonth');
        const dashboardDateRange = document.getElementById('dashboardDateRange');
        const totalProduction = document.getElementById('totalProduction');
        const totalLoadingTime = document.getElementById('totalLoadingTime');
        const tableHeader = document.getElementById('tableHeader');
        const lineTableBody = document.getElementById('lineTableBody');
        // Input Page Elements
        const inputPageTitle = document.getElementById('inputPageTitle');
        const inputUserAvatar = document.getElementById('inputUserAvatar');
        const inputLogoutBtn = document.getElementById('inputLogoutBtn');
        const productionForm = document.getElementById('productionForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const submitSpinner = document.getElementById('submitSpinner');
        const inputStatusMessage = document.getElementById('inputStatusMessage');
        const shiftSelect = document.getElementById('shift');
        const shiftInfo = document.getElementById('shiftInfo');
        const lineSelect = document.getElementById('namaLineProduksi');
        const partSelect = document.getElementById('namaPart');
        const documentIdInput = document.getElementById('documentId');
        const formTitle = document.getElementById('formTitle');
        // KPP Page Elements
        const kppUserAvatar = document.getElementById('kppUserAvatar');
        const kppLogoutBtn = document.getElementById('kppLogoutBtn');
        const kppForm = document.getElementById('kppForm');
        const kppSubmitBtn = document.getElementById('kppSubmitBtn');
        const kppSubmitText = document.getElementById('kppSubmitText');
        const kppSubmitSpinner = document.getElementById('kppSubmitSpinner');
        const kppStatusMessage = document.getElementById('kppStatusMessage');
        const kppLineSelect = document.getElementById('kppLineProduksi');
        const kppPartSelect = document.getElementById('kppPart');
        const kppProsesSelect = document.getElementById('kppProses');
        const kppItemNGSelect = document.getElementById('kppItemNG');
        const kppDocumentIdInput = document.getElementById('kppDocumentId');
        // Profile Page Elements
        const profileUserAvatar = document.getElementById('profileUserAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const loginMethod = document.getElementById('loginMethod');
        const joinDate = document.getElementById('joinDate');
        const userUid = document.getElementById('userUid');
        const profileLogoutBtn = document.getElementById('profileLogoutBtn');
        const profileLogoutBtn2 = document.getElementById('profileLogoutBtn2');
        // Settings Page Elements
        const settingsUserAvatar = document.getElementById('settingsUserAvatar');
        const settingsLogoutBtn = document.getElementById('settingsLogoutBtn');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const autoLogoutTime = document.getElementById('autoLogoutTime');
        const lineAccessContainer = document.getElementById('lineAccessContainer');
        const inputPermissionToggle = document.getElementById('inputPermissionToggle');
        const editPermissionToggle = document.getElementById('editPermissionToggle');
        const savePermissionsBtn = document.getElementById('savePermissionsBtn');
        // Navigation Elements
        const homeNav = document.getElementById('homeNav');
        const inputNav = document.getElementById('inputNav');
        const kppNav = document.getElementById('kppNav');
        const profileNav = document.getElementById('profileNav');
        const settingsNav = document.getElementById('settingsNav');
        const homeNav2 = document.getElementById('homeNav2');
        const inputNav2 = document.getElementById('inputNav2');
        const kppNav2 = document.getElementById('kppNav2');
        const profileNav2 = document.getElementById('profileNav2');
        const settingsNav2 = document.getElementById('settingsNav2');
        const homeNav3 = document.getElementById('homeNav3');
        const inputNav3 = document.getElementById('inputNav3');
        const kppNav3 = document.getElementById('kppNav3');
        const profileNav3 = document.getElementById('profileNav3');
        const settingsNav3 = document.getElementById('settingsNav3');
        const homeNav4 = document.getElementById('homeNav4');
        const inputNav4 = document.getElementById('inputNav4');
        const kppNav4 = document.getElementById('kppNav4');
        const profileNav4 = document.getElementById('profileNav4');
        const settingsNav4 = document.getElementById('settingsNav4');
        // Delete Modal Elements
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        // Filter Elements
        const filterLine = document.getElementById('filterLine');
        const filterPart = document.getElementById('filterPart');
        const filterGroup = document.getElementById('filterGroup');
        const filterShift = document.getElementById('filterShift');
        const resetFilterBtn = document.getElementById('resetFilterBtn');
        // Auto Logout Elements
        const autoLogoutWarning = document.getElementById('autoLogoutWarning');
        const autoLogoutTimer = document.getElementById('autoLogoutTimer');
        const stayLoggedInBtn = document.getElementById('stayLoggedInBtn');
        const logoutNowBtn = document.getElementById('logoutNowBtn');
        // Refresh Loading Popup
        const refreshLoadingPopup = document.getElementById('refreshLoadingPopup');
        // Dashboard Selection Elements
        const dashboardSelection = document.getElementById('dashboardSelection');
        const manhourDashboard = document.getElementById('manhourDashboard');
        const kppDashboard = document.getElementById('kppDashboard');
        const manhourDashboardBtn = document.getElementById('manhourDashboardBtn');
        const kppDashboardBtn = document.getElementById('kppDashboardBtn');
        // KPP Dashboard Elements
        const kppCurrentMonth = document.getElementById('kppCurrentMonth');
        const kppPrevMonth = document.getElementById('kppPrevMonth');
        const kppNextMonth = document.getElementById('kppNextMonth');
        const kppDashboardDateRange = document.getElementById('kppDashboardDateRange');
        const totalNG = document.getElementById('totalNG');
        const totalItemNG = document.getElementById('totalItemNG');
        const kppTableHeader = document.getElementById('kppTableHeader');
        const kppTableBody = document.getElementById('kppTableBody');
        const kppDataContainer = document.getElementById('kppDataContainer');
        const kppNoDataMessage = document.getElementById('kppNoDataMessage');
        // KPP Filter Elements
        const kppFilterLine = document.getElementById('kppFilterLine');
        const kppFilterPart = document.getElementById('kppFilterPart');
        const kppFilterProses = document.getElementById('kppFilterProses');
        const kppResetFilterBtn = document.getElementById('kppResetFilterBtn');
        // State variables
        let currentUser = null;
        let currentDate = new Date();
        let currentKppDate = new Date(); // For KPP dashboard
        let currentEditDocId = null;
        let userPermissions = null;
        // Auto Logout State
        let inactivityTimer;
        let warningTimer;
        let logoutTime = 30 * 60 * 1000; // Default 30 minutes
        let warningTime = 60 * 1000; // 1 minute warning
        let timeLeft = logoutTime;
        // Data line produksi dan part
        const linePartData = {
            'COMMON RAIL 01': [ '634F', 'E494', 'E694', 'H6-A', 'P3263','P3267', 'MDE8'],
            'COMMON RAIL 02': ['902F'],
            'COMMON RAIL 03': [ 'JDE20', '4N13','RT56', 'VM', 'VM USA'],
            'COMMON RAIL 04': ['4N16', 'MDE5'],
            'COMMON RAIL 05': ['4J', 'N4','N6', '902F','RT50' ],
            'COMMON RAIL 06': ['RZ4E'],
            'COMMON RAIL 07': ['CR22','4N15B', '4N15', 'S320', 'YD25', 'YD2K3'],
            'COMMON RAIL 08': ['902FC', '1KD', '415F'],
            'COMMON RAIL 09': ['902FB', 'GDB'],
            'COMMON RAIL 10': ['902FG', 'RG01'],
            'COMMON RAIL 11': ['19MY', 'RZ4E', '902FD'],
            'COMMON RAIL 12': ['902FF', 'ES01B']
        };
        // Data KPP NG
        const kppNgData = {
            "COMMON RAIL 12": {
                "902FF": {
                    "#10": [
                        "Ã 5.4 Besar / Kecil / Step",
                        "Ã 9.3 Besar / Kecil / Step",
                        "Drill Ã 9.3 Patah / Gompal",
                        "Drill Ã 5.1 Patah / Gompal",
                        "Reamer Ã 5.4 Patah / Gompal",
                        "Proses Miring / Salah Pemasangan #10",
                        "Lain-lain #10"
                    ],
                    "#20": [
                        "Lub.Gundril miring",
                        "Lub.Gundril kasar",
                        "Lub.Gundril over load",
                        "Gundrill Patah",
                        "Proses Miring / Salah Pemasangan #20",
                        "Lain - lain #20"
                    ],
                    "#30": [
                        "Seal plug M20 Kasar / Gores / Bibiri / Gosong",
                        "Ulir M20 Longgar / Seret",
                        "Lubang ÃM20 Besar / kecil / Step",
                        "Tap M20 Patah / Gompal",
                        "Ketebalan Muka baut",
                        "Proses Miring / Salah Pemasangan #30",
                        "Concentricity Gundrill Miring M20 Mekura",
                        "Lain - lain #30"
                    ],
                    "#70": [
                        "Drill Ã4 Patah / Gompal",
                        "Seal M20 Kasar / Gores / Bibiri",
                        "Diameter Seal M20 Besar / Kecil",
                        "Lubang ÃM20 Besar / Kecil / Step",
                        "Tirus M20 gores, kasar, bibiri",
                        "Ulir M20 Longgar / Seret",
                        "Tap M20 Patah / Gompal",
                        "Seal M10 Kasar / Gores / Bibiri",
                        "Ulir M10 Longgar / Seret",
                        "Lub Ã M10 Besar / Kecil",
                        "Tap M10 Patah / Gompal",
                        "Ã17,6 Besar / kecil",
                        "Ã17,6 Kasar / Gores / Step",
                        "Ã17,4 Besar / kecil",
                        "Ã17,4 Kasar / Gores / Step",
                        "Seal Men M10 Unbalance",
                        "NG Posisi Seal M10",
                        "NG Tenaoshi Seal & Tirus M20 & M10",
                        "Concentricity Gundrill Miring M20",
                        "Proses Miring / Salah Pemasangan #70",
                        "Lain - lain #70"
                    ],
                    "#80": [
                        "Drill Ã0.67 Patah",
                        "Reamer Ã0.68 Patah",
                        "Lubang Ã0,7 Over",
                        "Center Drill Ã0.7 Patah",
                        "Drill Ã4.0 Patah / Gompal",
                        "Reamer 90Â° Patah / Gompal",
                        "Seal Inj M14 Kasar / Gores / Bibiri",
                        "ÃM14 Besar / Kecil / Oval",
                        "Ulir M14 Longgar / Seret",
                        "Tap M14 Patah / Gompal",
                        "Posisi Miring / Salah Pemasangan #80",
                        "NG Tenaoshi 90Â°",
                        "Lain - lain #80"
                    ],
                    "#120": [
                        "Muka Taper 90Âº Mushire",
                        "Lubang Ã0.7 Miring",
                        "Ã4.0 Kasar Gores",
                        "Dakon",
                        "Lain-lain #120"
                    ]
                },







            
            // Tambahkan data untuk part lain jika ada
          }
          // Tambahkan data untuk line lain jika ada
        };
        // Refresh Loading Popup Functions
        function showRefreshLoading() {
            refreshLoadingPopup.classList.add('show');
        }
        function hideRefreshLoading() {
            refreshLoadingPopup.classList.remove('show');
        }
        // Tampilkan loading saat halaman dimuat
        showRefreshLoading();
        // Sembunyikan loading setelah semua konten dimuat
        window.addEventListener('load', function() {
            // Tambahkan sedikit delay agar terlihat jika loading sangat cepat
            setTimeout(hideRefreshLoading, 300);
        });
        // Custom Alert Functions
        function showAlert(title, message, onConfirm, showCancel = true) {
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alertCancelBtn.style.display = showCancel ? 'block' : 'none';
            // Set up event listeners
            const confirmHandler = () => {
                closeAlert();
                if (onConfirm) onConfirm();
            };
            const cancelHandler = () => {
                closeAlert();
            };
            const closeHandler = () => {
                closeAlert();
            };
            alertConfirmBtn.addEventListener('click', confirmHandler, { once: true });
            alertCancelBtn.addEventListener('click', cancelHandler, { once: true });
            alertCloseBtn.addEventListener('click', closeHandler, { once: true });
            // Show alert
            customAlert.classList.add('show');
        }
        function closeAlert() {
            customAlert.classList.remove('show');
        }
        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
        // Format month for display
        function formatMonth(date) {
            const options = { year: 'numeric', month: 'long' };
            return date.toLocaleDateString('id-ID', options);
        }
        // Format date range for dashboard (1st to last day of current month)
        function formatDateRange() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const options = { day: 'numeric', month: 'long' };
            dashboardDateRange.textContent = `${firstDay.getDate()} - ${lastDay.getDate()} ${firstDay.toLocaleDateString('id-ID', options)} ${year}`;
        }
        // Format date range for KPP dashboard
        function formatKppDateRange() {
            const year = currentKppDate.getFullYear();
            const month = currentKppDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const options = { day: 'numeric', month: 'long' };
            kppDashboardDateRange.textContent = `${firstDay.getDate()} - ${lastDay.getDate()} ${firstDay.toLocaleDateString('id-ID', options)} ${year}`;
        }
        // Update month display
        function updateMonthDisplay() {
            currentMonth.textContent = formatMonth(currentDate);
            kppCurrentMonth.textContent = formatMonth(currentKppDate);
        }
        // Calculate dashboard statistics
        function calculateDashboardStats(dataList) {
            // Total production
            const totalProd = dataList.reduce((sum, data) => sum + data.sigmaProduksi, 0);
            totalProduction.textContent = totalProd.toLocaleString();
            // Total loading time
            const totalLoadTime = dataList.reduce((sum, data) => sum + data.loadingTime, 0);
            totalLoadingTime.textContent = totalLoadTime.toLocaleString();
        }
        // Calculate KPP dashboard statistics
        function calculateKppDashboardStats(kppDataList) {
            // Total NG
            const totalNgCount = kppDataList.reduce((sum, data) => sum + data.jumlahNG, 0);
            totalNG.textContent = totalNgCount.toLocaleString();
            // Total Item NG (jumlah dokumen)
            totalItemNG.textContent = kppDataList.length.toLocaleString();
        }
        // Generate line monitoring table
        function generateLineMonitoringTable(dataList) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            // Clear existing header content first
            tableHeader.innerHTML = '';
            // Create the main header row (tanggal) - Use insertRow/insertCell for better structure
            const headerRow = document.createElement('tr');
            const lineNameHeader = document.createElement('th');
            lineNameHeader.rowSpan = 2; // Span 2 rows
            lineNameHeader.textContent = 'Line Produksi';
            lineNameHeader.style.textAlign = 'center'; // Optional: Center align
            headerRow.appendChild(lineNameHeader);
            // Create sub-header row (Prod/LT)
            const subHeaderRow = document.createElement('tr');
            // Loop through days to create headers
            for (let day = 1; day <= daysInMonth; day++) {
                // Main header cell for the day (spans 2 columns)
                const dayHeader = document.createElement('th');
                dayHeader.colSpan = 2; // Span 2 columns for Prod & LT
                dayHeader.textContent = day;
                dayHeader.style.textAlign = 'center'; // Center align day number
                headerRow.appendChild(dayHeader);
                // Sub-header cells for 'Prod' and 'LT'
                const prodSubHeader = document.createElement('th');
                prodSubHeader.textContent = 'Prod';
                prodSubHeader.style.fontSize = '0.75rem';
                prodSubHeader.style.textAlign = 'center'; // Align sub-headers
                subHeaderRow.appendChild(prodSubHeader);
                const ltSubHeader = document.createElement('th');
                ltSubHeader.textContent = 'LT';
                ltSubHeader.style.fontSize = '0.75rem';
                ltSubHeader.style.textAlign = 'center'; // Align sub-headers
                subHeaderRow.appendChild(ltSubHeader);
            }
            // Append both header rows to the table header
            tableHeader.appendChild(headerRow);
            tableHeader.appendChild(subHeaderRow);
            // Group data by line, date, and shift
            // Store both sigmaProduksi (prod) and loadingTime (lt)
            const lineData = {};
            dataList.forEach(data => {
                const line = data.namaLineProduksi;
                const dateObj = new Date(data.tanggal);
                // Ensure date comparison works correctly with date strings
                const dateKey = dateObj.toISOString().split('T')[0]; // Use YYYY-MM-DD format for key
                const shift = data.shift;
                if (!lineData[line]) {
                    lineData[line] = {};
                }
                if (!lineData[line][dateKey]) {
                    lineData[line][dateKey] = { '1': { prod: 0, lt: 0 }, '2': { prod: 0, lt: 0 } };
                }
                // Aggregate production and loading time
                lineData[line][dateKey][shift].prod += data.sigmaProduksi;
                lineData[line][dateKey][shift].lt += data.loadingTime;
            });
            // Generate table rows
            const lineNames = [
                'COMMON RAIL 01', 'COMMON RAIL 02', 'COMMON RAIL 03', 'COMMON RAIL 04',
                'COMMON RAIL 05', 'COMMON RAIL 06', 'COMMON RAIL 07', 'COMMON RAIL 08',
                'COMMON RAIL 09', 'COMMON RAIL 10', 'COMMON RAIL 11', 'COMMON RAIL 12'
            ];
            let tableRowsHTML = '';
            lineNames.forEach(lineName => {
                // Shift 1 row
                let shift1RowHTML = `<tr><td>${lineName} (Shift 1)</td>`;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = new Date(year, month, day).toISOString().split('T')[0];
                    const data = lineData[lineName] && lineData[lineName][dateKey];
                    if (data && (data['1'].prod > 0 || data['1'].lt > 0)) {
                        // Display Production and Loading Time side-by-side
                        shift1RowHTML += `<td style="text-align:right;">${data['1'].prod}</td><td style="text-align:right;">${data['1'].lt}</td>`;
                    } else {
                        shift1RowHTML += '<td>-</td><td>-</td>';
                    }
                }
                shift1RowHTML += '</tr>';
                tableRowsHTML += shift1RowHTML;
                // Shift 2 row
                let shift2RowHTML = `<tr><td>${lineName} (Shift 2)</td>`;
                for (let day = 1; day <= daysInMonth; day++) {
                     const dateKey = new Date(year, month, day).toISOString().split('T')[0];
                    const data = lineData[lineName] && lineData[lineName][dateKey];
                    if (data && (data['2'].prod > 0 || data['2'].lt > 0)) {
                        // Display Production and Loading Time side-by-side
                        shift2RowHTML += `<td style="text-align:right;">${data['2'].prod}</td><td style="text-align:right;">${data['2'].lt}</td>`;
                    } else {
                        shift2RowHTML += '<td>-</td><td>-</td>';
                    }
                }
                shift2RowHTML += '</tr>';
                tableRowsHTML += shift2RowHTML;
                // Separator row
                // Adjust colspan to account for double columns (days * 2) + line name column
                tableRowsHTML += `<tr class="shift-separator"><td colspan="${(daysInMonth * 2) + 1}"></td></tr>`;
            });
            lineTableBody.innerHTML = tableRowsHTML;
        }
        // Generate KPP monitoring table
        function generateKppMonitoringTable(kppDataList) {
            const year = currentKppDate.getFullYear();
            const month = currentKppDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Clear existing header content first
            kppTableHeader.innerHTML = '';
            
            // Create the main header row (tanggal)
            const headerRow = document.createElement('tr');
            const lineNameHeader = document.createElement('th');
            lineNameHeader.textContent = 'Line Produksi';
            lineNameHeader.style.textAlign = 'center';
            headerRow.appendChild(lineNameHeader);
            
            // Loop through days to create headers
            for (let day = 1; day <= daysInMonth; day++) {
                const dayHeader = document.createElement('th');
                dayHeader.textContent = day;
                dayHeader.style.textAlign = 'center';
                headerRow.appendChild(dayHeader);
            }
            
            // Append header row to the table header
            kppTableHeader.appendChild(headerRow);
            
            // Group KPP data by line and date
            const kppLineData = {};
            kppDataList.forEach(data => {
                const line = data.namaLineProduksi;
                const dateObj = new Date(data.tanggal);
                const dateKey = dateObj.toISOString().split('T')[0]; // Use YYYY-MM-DD format for key
                
                if (!kppLineData[line]) {
                    kppLineData[line] = {};
                }
                
                if (!kppLineData[line][dateKey]) {
                    kppLineData[line][dateKey] = 0;
                }
                
                // Aggregate jumlah NG
                kppLineData[line][dateKey] += data.jumlahNG;
            });
            
            // Generate table rows
            const lineNames = [
                'COMMON RAIL 01', 'COMMON RAIL 02', 'COMMON RAIL 03', 'COMMON RAIL 04',
                'COMMON RAIL 05', 'COMMON RAIL 06', 'COMMON RAIL 07', 'COMMON RAIL 08',
                'COMMON RAIL 09', 'COMMON RAIL 10', 'COMMON RAIL 11', 'COMMON RAIL 12'
            ];
            
            let tableRowsHTML = '';
            lineNames.forEach(lineName => {
                let lineRowHTML = `<tr><td>${lineName}</td>`;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = new Date(year, month, day).toISOString().split('T')[0];
                    const ngCount = kppLineData[lineName] && kppLineData[lineName][dateKey];
                    
                    if (ngCount > 0) {
                        lineRowHTML += `<td style="text-align:right; color: var(--danger-color); font-weight: bold;">${ngCount}</td>`;
                    } else {
                        lineRowHTML += '<td>-</td>';
                    }
                }
                
                lineRowHTML += '</tr>';
                tableRowsHTML += lineRowHTML;
            });
            
            kppTableBody.innerHTML = tableRowsHTML;
        }
        // Fungsi untuk mengisi opsi part berdasarkan line yang dipilih di filter
        function updateFilterPartOptions() {
            const selectedLine = filterLine.value;
            filterPart.innerHTML = '<option value="">Semua Part</option>';
            if (selectedLine && linePartData[selectedLine]) {
                linePartData[selectedLine].forEach(part => {
                    const option = document.createElement('option');
                    option.value = part;
                    option.textContent = part;
                    filterPart.appendChild(option);
                });
            }
        }
        
        // Fungsi untuk mengisi opsi part berdasarkan line yang dipilih di filter KPP
        function updateKppFilterPartOptions() {
            const selectedLine = kppFilterLine.value;
            kppFilterPart.innerHTML = '<option value="">Semua Part</option>';
            if (selectedLine && kppNgData[selectedLine]) {
                const parts = Object.keys(kppNgData[selectedLine]);
                parts.forEach(part => {
                    const option = document.createElement('option');
                    option.value = part;
                    option.textContent = part;
                    kppFilterPart.appendChild(option);
                });
            }
        }
        // Fetch data from Firestore
        async function fetchData() {
            try {
                // Calculate start and end of current month
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const startDate = new Date(year, month, 1);
                const endDate = new Date(year, month + 1, 0, 23, 59, 59);
                // Query data for the current month
                const q = query(
                    collection(db, "produksiData"),
                    where("tanggal", ">=", startDate.toISOString().split('T')[0]),
                    where("tanggal", "<=", endDate.toISOString().split('T')[0]),
                    orderBy("tanggal", "desc")
                );
                const querySnapshot = await getDocs(q);
                const dataList = [];
                querySnapshot.forEach((doc) => {
                    dataList.push({ id: doc.id, ...doc.data() });
                });
                // Simpan data lengkap untuk filter
                window.fullDataList = dataList;
                // Update dashboard
                calculateDashboardStats(dataList);
                generateLineMonitoringTable(dataList);
                // Render recent data list
                renderData(dataList);
            } catch (error) {
                console.error("Error fetching data: ", error);
                showAlert('Error', 'Gagal memuat data: ' + error.message);
            }
        }
        // Fetch KPP data from Firestore
        async function fetchKppData() {
            try {
                // Calculate start and end of current month for KPP
                const year = currentKppDate.getFullYear();
                const month = currentKppDate.getMonth();
                const startDate = new Date(year, month, 1);
                const endDate = new Date(year, month + 1, 0, 23, 59, 59);
                
                // Query KPP data for the current month
                const q = query(
                    collection(db, "collection_kpp"),
                    where("tanggal", ">=", startDate.toISOString().split('T')[0]),
                    where("tanggal", "<=", endDate.toISOString().split('T')[0]),
                    orderBy("tanggal", "desc")
                );
                const querySnapshot = await getDocs(q);
                const kppDataList = [];
                querySnapshot.forEach((doc) => {
                    kppDataList.push({ id: doc.id, ...doc.data() });
                });
                
                // Simpan data lengkap untuk filter KPP
                window.fullKppDataList = kppDataList;
                
                // Update KPP dashboard
                calculateKppDashboardStats(kppDataList);
                generateKppMonitoringTable(kppDataList);
                
                // Render recent KPP data list
                renderKppData(kppDataList);
            } catch (error) {
                console.error("Error fetching KPP data: ", error);
                showAlert('Error', 'Gagal memuat data KPP: ' + error.message);
            }
        }
        // Render data to UI dengan filter
        function renderData(fullDataList) {
            // Terapkan filter
            let filteredDataList = [...fullDataList]; // Salin array untuk menghindari mutasi langsung
            // Filter berdasarkan hak akses pengguna
            if (userPermissions && userPermissions.accessibleLines) {
                filteredDataList = filteredDataList.filter(data => 
                    userPermissions.accessibleLines.includes(data.namaLineProduksi)
                );
            }
            if (filterLine.value) {
                filteredDataList = filteredDataList.filter(data => data.namaLineProduksi === filterLine.value);
            }
            if (filterPart.value) {
                filteredDataList = filteredDataList.filter(data => data.namaPart === filterPart.value);
            }
            if (filterGroup.value) {
                filteredDataList = filteredDataList.filter(data => data.group === filterGroup.value);
            }
            if (filterShift.value) {
                filteredDataList = filteredDataList.filter(data => data.shift === filterShift.value);
            }
            if (filteredDataList.length === 0) {
                noDataMessage.style.display = 'block';
                dataContainer.innerHTML = '';
                dataContainer.appendChild(noDataMessage);
                return;
            }
            noDataMessage.style.display = 'none';
            dataContainer.innerHTML = '';
            // Tampilkan data yang sudah difilter
            filteredDataList.forEach(data => {
                const dataCard = document.createElement('div');
                dataCard.className = 'data-card';
                dataCard.innerHTML = `
                    <div class="data-header">
                        <div class="data-title">${data.namaLineProduksi} - ${data.namaPart}</div>
                        <div class="data-date">${formatDate(data.tanggal)}</div>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Group:</span>
                        <span class="data-value">${data.group}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Shift:</span>
                        <span class="data-value">${data.shift}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Total Produksi:</span>
                        <span class="data-value">${data.sigmaProduksi}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Loading Time:</span>
                        <span class="data-value">${data.loadingTime} menit</span>
                    </div>
                    <div class="action-buttons">
                        ${userPermissions && userPermissions.canEdit ? `
                            <button class="btn-edit" data-id="${data.id}">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn-delete" data-id="${data.id}">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        ` : `
                            <button class="btn-edit" data-id="${data.id}" disabled>
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn-delete" data-id="${data.id}" disabled>
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        `}
                    </div>
                `;
                dataContainer.appendChild(dataCard);
            });
            // Tambahkan event listener untuk tombol edit dan hapus jika pengguna memiliki hak akses
            if (userPermissions && userPermissions.canEdit) {
                document.querySelectorAll('.btn-edit').forEach(button => {
                    if (!button.disabled) {
                        button.addEventListener('click', (e) => {
                            const docId = e.currentTarget.getAttribute('data-id');
                            editData(docId);
                        });
                    }
                });
                document.querySelectorAll('.btn-delete').forEach(button => {
                    if (!button.disabled) {
                        button.addEventListener('click', (e) => {
                            const docId = e.currentTarget.getAttribute('data-id');
                            showDeleteConfirmation(docId);
                        });
                    }
                });
            }
        }
        // Render KPP data to UI dengan filter
        function renderKppData(fullKppDataList) {
            // Terapkan filter
            let filteredKppDataList = [...fullKppDataList]; // Salin array untuk menghindari mutasi langsung
            // Filter berdasarkan hak akses pengguna
            if (userPermissions && userPermissions.accessibleLines) {
                filteredKppDataList = filteredKppDataList.filter(data => 
                    userPermissions.accessibleLines.includes(data.namaLineProduksi)
                );
            }
            if (kppFilterLine.value) {
                filteredKppDataList = filteredKppDataList.filter(data => data.namaLineProduksi === kppFilterLine.value);
            }
            if (kppFilterPart.value) {
                filteredKppDataList = filteredKppDataList.filter(data => data.namaPart === kppFilterPart.value);
            }
            if (kppFilterProses.value) {
                filteredKppDataList = filteredKppDataList.filter(data => data.proses === kppFilterProses.value);
            }
            if (filteredKppDataList.length === 0) {
                kppNoDataMessage.style.display = 'block';
                kppDataContainer.innerHTML = '';
                kppDataContainer.appendChild(kppNoDataMessage);
                return;
            }
            kppNoDataMessage.style.display = 'none';
            kppDataContainer.innerHTML = '';
            // Tampilkan data KPP yang sudah difilter
            filteredKppDataList.forEach(data => {
                const kppDataCard = document.createElement('div');
                kppDataCard.className = 'kpp-data-card';
                kppDataCard.innerHTML = `
                    <div class="kpp-data-header">
                        <div class="kpp-data-title">${data.namaLineProduksi} - ${data.namaPart}</div>
                        <div class="kpp-data-date">${formatDate(data.tanggal)}</div>
                    </div>
                    <div class="kpp-data-item">
                        <span class="kpp-data-label">Proses:</span>
                        <span class="kpp-data-value">${data.proses}</span>
                    </div>
                    <div class="kpp-data-item">
                        <span class="kpp-data-label">Item NG:</span>
                        <span class="kpp-data-value">${data.itemNG}</span>
                    </div>
                    <div class="kpp-data-item">
                        <span class="kpp-data-label">Jumlah NG:</span>
                        <span class="kpp-data-value">${data.jumlahNG} pcs</span>
                    </div>
                    <div class="action-buttons">
                        ${userPermissions && userPermissions.canEdit ? `
                            <button class="btn-edit" data-id="${data.id}" disabled>
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn-delete" data-id="${data.id}">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        ` : `
                            <button class="btn-edit" data-id="${data.id}" disabled>
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn-delete" data-id="${data.id}" disabled>
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        `}
                    </div>
                `;
                kppDataContainer.appendChild(kppDataCard);
            });
            // Tambahkan event listener untuk tombol hapus jika pengguna memiliki hak akses
            if (userPermissions && userPermissions.canEdit) {
                document.querySelectorAll('#kppDataContainer .btn-delete').forEach(button => {
                    if (!button.disabled) {
                        button.addEventListener('click', (e) => {
                            const docId = e.currentTarget.getAttribute('data-id');
                            showDeleteKppConfirmation(docId);
                        });
                    }
                });
            }
        }
        // Edit data
        async function editData(docId) {
            // Cek hak akses edit
            if (!userPermissions || !userPermissions.canEdit) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk mengedit data.');
                return;
            }
            try {
                const docRef = doc(db, "produksiData", docId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    // Cek apakah user memiliki akses ke line produksi ini
                    if (userPermissions.accessibleLines && 
                        !userPermissions.accessibleLines.includes(data.namaLineProduksi)) {
                        showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk mengedit data line produksi ini.');
                        return;
                    }
                    // Set form values
                    documentIdInput.value = docId;
                    document.getElementById('namaLineProduksi').value = data.namaLineProduksi;
                    updatePartOptions(); // Update part options first
                    document.getElementById('namaPart').value = data.namaPart;
                    document.getElementById('tanggal').value = data.tanggal;
                    document.getElementById('group').value = data.group;
                    document.getElementById('shift').value = data.shift;
                    document.getElementById('sigmaProduksi').value = data.sigmaProduksi;
                    document.getElementById('sigmaOP').value = data.sigmaOP;
                    document.getElementById('loadingTime').value = data.loadingTime;
                    // Update shift info
                    updateShiftInfo();
                    // Change form title and button text
                    formTitle.textContent = 'Edit Data Produksi';
                    inputPageTitle.textContent = 'Edit Data';
                    submitText.textContent = 'Update Data';
                    // Enable part select
                    document.getElementById('namaPart').disabled = false;
                    // Show input page
                    showPage('inputPage');
                } else {
                    showAlert('Error', 'Dokumen tidak ditemukan!');
                }
            } catch (error) {
                console.error("Error getting document: ", error);
                showAlert('Error', 'Gagal mengambil data: ' + error.message);
            }
        }
        // Show delete confirmation for produksi data
        function showDeleteConfirmation(docId) {
            // Cek hak akses hapus
            if (!userPermissions || !userPermissions.canEdit) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk menghapus data.');
                return;
            }
            currentEditDocId = docId;
            deleteModal.show();
        }
        // Show delete confirmation for KPP data
        function showDeleteKppConfirmation(docId) {
            // Cek hak akses hapus
            if (!userPermissions || !userPermissions.canEdit) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk menghapus data.');
                return;
            }
            currentEditDocId = docId;
            deleteModal.show();
        }
        // Delete data (bisa untuk produksi atau KPP)
        async function deleteData() {
            if (!currentEditDocId) return;
            try {
                // Cek apakah ini data produksi atau KPP berdasarkan konteks
                // Untuk contoh ini, kita asumsikan hanya ada satu koleksi yang dihapus
                // Dalam implementasi nyata, Anda mungkin perlu menandai jenis data
                
                // Coba hapus dari produksiData dulu
                try {
                    await deleteDoc(doc(db, "produksiData", currentEditDocId));
                    console.log("Document produksi successfully deleted!");
                } catch (e) {
                    // Jika gagal, coba hapus dari collection_kpp
                    await deleteDoc(doc(db, "collection_kpp", currentEditDocId));
                    console.log("Document KPP successfully deleted!");
                }
                
                deleteModal.hide();
                fetchData(); // Refresh data produksi
                fetchKppData(); // Refresh data KPP
                showAlert('Sukses', 'Data berhasil dihapus!');
            } catch (error) {
                console.error("Error deleting document: ", error);
                showAlert('Error', 'Gagal menghapus data: ' + error.message);
            }
        }
        // Update part options based on selected line
        function updatePartOptions() {
            const selectedLine = lineSelect.value;
            partSelect.innerHTML = '<option value="" selected disabled>Pilih Part</option>';
            if (selectedLine && linePartData[selectedLine]) {
                partSelect.disabled = false;
                linePartData[selectedLine].forEach(part => {
                    const option = document.createElement('option');
                    option.value = part;
                    option.textContent = part;
                    partSelect.appendChild(option);
                });
            } else {
                partSelect.disabled = true;
                partSelect.innerHTML = '<option value="" selected disabled>Pilih Line Produksi Terlebih Dahulu</option>';
            }
        }
        // Update shift information
        function updateShiftInfo() {
            const shift = shiftSelect.value;
            if (shift === '1') {
                shiftInfo.innerHTML = 'Jam Kerja: 07.10 - 16.10<br>Lembur: 1 jam (17.30) / 2 jam (18.30)';
                shiftInfo.classList.remove('d-none');
            } else if (shift === '2') {
                shiftInfo.innerHTML = 'Jam Kerja: 19.50 - 04.50<br>Lembur: 1 jam (06.10) / 2 jam (07.10)';
                shiftInfo.classList.remove('d-none');
            } else {
                shiftInfo.classList.add('d-none');
            }
        }
        // Set loading state for login button
        function setLoginLoading(isLoading) {
            if (isLoading) {
                loginText.textContent = 'Memverifikasi...';
                loginSpinner.classList.remove('d-none');
                loginBtn.disabled = true;
            } else {
                loginText.textContent = 'Login';
                loginSpinner.classList.add('d-none');
                loginBtn.disabled = false;
            }
        }
        // Show login status message
        function showLoginStatus(message, isError = false) {
            loginStatus.textContent = message;
            loginStatus.className = `status-message mt-3 ${isError ? 'alert alert-danger' : 'd-none'}`;
        }
        // Set loading state for submit button
        function setInputLoading(isLoading) {
            if (isLoading) {
                submitText.textContent = documentIdInput.value ? 'Memperbarui...' : 'Menyimpan...';
                submitSpinner.classList.remove('d-none');
                submitBtn.disabled = true;
            } else {
                submitText.textContent = documentIdInput.value ? 'Update Data' : 'Simpan Data';
                submitSpinner.classList.add('d-none');
                submitBtn.disabled = false;
            }
        }
        // Show input status message
        function showInputStatus(message, isError = false) {
            inputStatusMessage.textContent = message;
            inputStatusMessage.className = `status-message mt-3 ${isError ? 'alert alert-danger' : 'alert alert-success'} ${message ? '' : 'd-none'}`;
        }
        // Reset form
        function resetForm() {
            productionForm.reset();
            documentIdInput.value = '';
            shiftInfo.classList.add('d-none');
            partSelect.disabled = true;
            partSelect.innerHTML = '<option value="" selected disabled>Pilih Line Produksi Terlebih Dahulu</option>';
            formTitle.textContent = 'Input Data Produksi';
            inputPageTitle.textContent = 'Input Data';
            submitText.textContent = 'Simpan Data';
        }
        // --- Fungsi KPP ---
        // Update part options for KPP based on selected line
        function updateKppPartOptions() {
            const selectedLine = kppLineSelect.value;
            kppPartSelect.innerHTML = '<option value="" selected disabled>Pilih Part</option>';
            kppProsesSelect.innerHTML = '<option value="" selected disabled>Pilih Part Terlebih Dahulu</option>';
            kppItemNGSelect.innerHTML = '<option value="" selected disabled>Pilih Proses Terlebih Dahulu</option>';
            kppProsesSelect.disabled = true;
            kppItemNGSelect.disabled = true;

            if (selectedLine && kppNgData[selectedLine]) {
                const parts = Object.keys(kppNgData[selectedLine]);
                if (parts.length > 0) {
                    kppPartSelect.disabled = false;
                    parts.forEach(part => {
                        const option = document.createElement('option');
                        option.value = part;
                        option.textContent = part;
                        kppPartSelect.appendChild(option);
                    });
                } else {
                    kppPartSelect.disabled = true;
                }
            } else {
                kppPartSelect.disabled = true;
            }
        }

        // Update proses options for KPP based on selected part
        function updateKppProsesOptions() {
            const selectedLine = kppLineSelect.value;
            const selectedPart = kppPartSelect.value;
            kppProsesSelect.innerHTML = '<option value="" selected disabled>Pilih Proses</option>';
            kppItemNGSelect.innerHTML = '<option value="" selected disabled>Pilih Proses Terlebih Dahulu</option>';
            kppItemNGSelect.disabled = true;

            if (selectedLine && selectedPart && kppNgData[selectedLine] && kppNgData[selectedLine][selectedPart]) {
                const prosesList = Object.keys(kppNgData[selectedLine][selectedPart]);
                if (prosesList.length > 0) {
                    kppProsesSelect.disabled = false;
                    prosesList.forEach(proses => {
                        const option = document.createElement('option');
                        option.value = proses;
                        option.textContent = proses;
                        kppProsesSelect.appendChild(option);
                    });
                } else {
                    kppProsesSelect.disabled = true;
                }
            } else {
                kppProsesSelect.disabled = true;
            }
        }

        // Update item NG options for KPP based on selected proses
        function updateKppItemNGOptions() {
            const selectedLine = kppLineSelect.value;
            const selectedPart = kppPartSelect.value;
            const selectedProses = kppProsesSelect.value;
            kppItemNGSelect.innerHTML = '<option value="" selected disabled>Pilih Item NG</option>';

            if (selectedLine && selectedPart && selectedProses &&
                kppNgData[selectedLine] && kppNgData[selectedLine][selectedPart] &&
                kppNgData[selectedLine][selectedPart][selectedProses]) {

                const ngItems = kppNgData[selectedLine][selectedPart][selectedProses];
                if (ngItems.length > 0) {
                    kppItemNGSelect.disabled = false;
                    ngItems.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item;
                        option.textContent = item;
                        kppItemNGSelect.appendChild(option);
                    });
                } else {
                    kppItemNGSelect.disabled = true;
                }
            } else {
                kppItemNGSelect.disabled = true;
            }
        }

        // Set loading state for KPP submit button
        function setKppInputLoading(isLoading) {
            if (isLoading) {
                kppSubmitText.textContent = kppDocumentIdInput.value ? 'Memperbarui...' : 'Menyimpan...';
                kppSubmitSpinner.classList.remove('d-none');
                kppSubmitBtn.disabled = true;
            } else {
                kppSubmitText.textContent = kppDocumentIdInput.value ? 'Update Data KPP' : 'Simpan Data KPP';
                kppSubmitSpinner.classList.add('d-none');
                kppSubmitBtn.disabled = false;
            }
        }

        // Show KPP status message
        function showKppStatus(message, isError = false) {
            kppStatusMessage.textContent = message;
            kppStatusMessage.className = `status-message mt-3 ${isError ? 'alert alert-danger' : 'alert alert-success'} ${message ? '' : 'd-none'}`;
        }

        // Reset KPP form
        function resetKppForm() {
            kppForm.reset();
            kppDocumentIdInput.value = '';
            kppPartSelect.disabled = true;
            kppProsesSelect.disabled = true;
            kppItemNGSelect.disabled = true;
            kppPartSelect.innerHTML = '<option value="" selected disabled>Pilih Line Terlebih Dahulu</option>';
            kppProsesSelect.innerHTML = '<option value="" selected disabled>Pilih Part Terlebih Dahulu</option>';
            kppItemNGSelect.innerHTML = '<option value="" selected disabled>Pilih Proses Terlebih Dahulu</option>';
            kppSubmitText.textContent = 'Simpan Data KPP';
            // Set today's date as default
            document.getElementById('kppTanggal').valueAsDate = new Date();
        }

        // Show/hide KPP page
        function showKppPage() {
            // Hide all pages
            loginPage.classList.remove('active');
            homePage.classList.remove('active');
            inputPage.classList.remove('active');
            profilePage.classList.remove('active');
            settingsPage.classList.remove('active');
            kppPage.classList.remove('active'); // Tambahkan ini

            // Show KPP page
            kppPage.classList.add('active');

            // Update navigation active state (sederhanakan jika perlu)
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            kppNavKpp.classList.add('active'); // Sesuaikan dengan ID yang digunakan
            // Tambahkan juga untuk homeNavKpp, inputNavKpp, profileNavKpp, settingsNavKpp jika diperlukan
        }
        // Show/hide pages
        function showPage(pageId) {
            // Hide all pages
            loginPage.classList.remove('active');
            homePage.classList.remove('active');
            inputPage.classList.remove('active');
            kppPage.classList.remove('active');
            profilePage.classList.remove('active');
            settingsPage.classList.remove('active');
            // Show requested page
            document.getElementById(pageId).classList.add('active');
            // Update navigation active state
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (pageId === 'homePage') {
                homeNav.classList.add('active');
                homeNav2.classList.add('active');
                homeNav3.classList.add('active');
                homeNav4.classList.add('active');
            } else if (pageId === 'inputPage') {
                inputNav.classList.add('active');
                inputNav2.classList.add('active');
                inputNav3.classList.add('active');
                inputNav4.classList.add('active');
            } else if (pageId === 'kppPage') {
                kppNav.classList.add('active');
                kppNav2.classList.add('active');
                kppNav3.classList.add('active');
                kppNav4.classList.add('active');
            } else if (pageId === 'profilePage') {
                profileNav.classList.add('active');
                profileNav2.classList.add('active');
                profileNav3.classList.add('active');
                profileNav4.classList.add('active');
            } else if (pageId === 'settingsPage') {
                settingsNav.classList.add('active');
                settingsNav2.classList.add('active');
                settingsNav3.classList.add('active');
                settingsNav4.classList.add('active');
            }
        }
        // Update user profile display
        function updateUserProfile(user) {
            if (user) {
                const displayName = user.displayName || user.email.split('@')[0];
                const avatarText = displayName.charAt(0).toUpperCase();
                // Update avatars
                homeUserAvatar.textContent = avatarText;
                inputUserAvatar.textContent = avatarText;
                kppUserAvatar.textContent = avatarText;
                profileUserAvatar.textContent = avatarText;
                settingsUserAvatar.textContent = avatarText;
                profileAvatar.textContent = avatarText;
                // Update profile info
                profileName.textContent = displayName;
                profileEmail.textContent = user.email;
                userUid.textContent = user.uid;
                // Set login method
                if (user.providerData && user.providerData.length > 0) {
                    const provider = user.providerData[0].providerId;
                    loginMethod.textContent = provider === 'google.com' ? 'Google' : 'Username';
                }
                // Set join date
                if (user.metadata && user.metadata.creationTime) {
                    const creationDate = new Date(user.metadata.creationTime);
                    joinDate.textContent = creationDate.toLocaleDateString('id-ID');
                }
            }
        }
        // Generate line access checkboxes
        function generateLineAccessCheckboxes() {
            lineAccessContainer.innerHTML = '';
            const lineNames = [
                'COMMON RAIL 01', 'COMMON RAIL 02', 'COMMON RAIL 03', 'COMMON RAIL 04',
                'COMMON RAIL 05', 'COMMON RAIL 06', 'COMMON RAIL 07', 'COMMON RAIL 08',
                'COMMON RAIL 09', 'COMMON RAIL 10', 'COMMON RAIL 11', 'COMMON RAIL 12'
            ];
            lineNames.forEach(lineName => {
                const lineItem = document.createElement('div');
                lineItem.className = 'line-access-item';
                lineItem.innerHTML = `
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="line-${lineName.replace(/\s+/g, '-')}" value="${lineName}">
                        <label class="form-check-label" for="line-${lineName.replace(/\s+/g, '-')}">${lineName}</label>
                    </div>
                `;
                lineAccessContainer.appendChild(lineItem);
            });
        }
        // Update user permissions display
        function updateUserPermissionsDisplay() {
            if (userPermissions) {
                // Update accessible lines display
                const lineCheckboxes = lineAccessContainer.querySelectorAll('input[type="checkbox"]');
                lineCheckboxes.forEach(checkbox => {
                    checkbox.checked = userPermissions.accessibleLines.includes(checkbox.value);
                });
                // Update input permission display
                inputPermissionToggle.checked = userPermissions.canInput;
                // Update edit permission display
                editPermissionToggle.checked = userPermissions.canEdit;
            }
        }
        // Save user permissions
        async function saveUserPermissions() {
            if (!currentUser) return;
            // Get selected lines
            const selectedLines = [];
            const lineCheckboxes = lineAccessContainer.querySelectorAll('input[type="checkbox"]');
            lineCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedLines.push(checkbox.value);
                }
            });
            // Get permissions
            const canInput = inputPermissionToggle.checked;
            const canEdit = editPermissionToggle.checked;
            // Create permissions object
            const permissions = {
                uid: currentUser.uid,
                accessibleLines: selectedLines,
                canInput: canInput,
                canEdit: canEdit
            };
            try {
                // Save to Firestore
                const userPermissionsRef = doc(db, "userPermissions", currentUser.uid);
                await setDoc(userPermissionsRef, permissions);
                // Update local permissions
                userPermissions = permissions;
                showAlert('Sukses', 'Hak akses berhasil disimpan!');
            } catch (error) {
                console.error("Error saving permissions: ", error);
                showAlert('Error', 'Gagal menyimpan hak akses: ' + error.message);
            }
        }
        // Get user permissions from Firestore
        async function getUserPermissions(uid) {
            try {
                const userPermissionsRef = doc(db, "userPermissions", uid);
                const userPermissionsSnap = await getDoc(userPermissionsRef);
                if (userPermissionsSnap.exists()) {
                    return userPermissionsSnap.data();
                } else {
                    // Return default permissions if not found
                    return {
                        uid: uid,
                        accessibleLines: [
                            'COMMON RAIL 01', 'COMMON RAIL 02', 'COMMON RAIL 03', 'COMMON RAIL 04',
                            'COMMON RAIL 05', 'COMMON RAIL 06', 'COMMON RAIL 07', 'COMMON RAIL 08',
                            'COMMON RAIL 09', 'COMMON RAIL 10', 'COMMON RAIL 11', 'COMMON RAIL 12'
                        ],
                        canInput: true,
                        canEdit: true
                    };
                }
            } catch (error) {
                console.error("Error getting user permissions: ", error);
                return null;
            }
        }
        // Auto Logout Functions
        function startInactivityTimer() {
            resetInactivityTimer();
            // Add event listeners for user activity
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer, true);
            });
        }
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            clearTimeout(warningTimer);
            timeLeft = logoutTime;
            inactivityTimer = setTimeout(() => {
                showAutoLogoutWarning();
            }, logoutTime - warningTime);
        }
        function showAutoLogoutWarning() {
            autoLogoutWarning.classList.remove('hidden');
            updateAutoLogoutTimer();
            warningTimer = setInterval(() => {
                timeLeft -= 1000;
                updateAutoLogoutTimer();
                if (timeLeft <= 0) {
                    clearInterval(warningTimer);
                    performLogout();
                }
            }, 1000);
        }
        function updateAutoLogoutTimer() {
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            autoLogoutTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        function hideAutoLogoutWarning() {
            autoLogoutWarning.classList.add('hidden');
            clearInterval(warningTimer);
        }
        function updateLogoutTime() {
            const selectedTime = parseInt(autoLogoutTime.value);
            logoutTime = selectedTime * 60 * 1000;
            // Save to localStorage
            localStorage.setItem('autoLogoutTime', selectedTime);
            resetInactivityTimer();
        }
        // Dark Mode Functions
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            // Save preference to localStorage
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        function loadSettings() {
            // Load dark mode preference
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }
            // Load auto logout time
            const savedLogoutTime = localStorage.getItem('autoLogoutTime');
            if (savedLogoutTime) {
                autoLogoutTime.value = savedLogoutTime;
                logoutTime = parseInt(savedLogoutTime) * 60 * 1000;
            }
        }
        // Handle user state changes
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                updateUserProfile(user);
                // Get user permissions
                userPermissions = await getUserPermissions(user.uid);
                updateUserPermissionsDisplay();
                showPage('homePage');
                // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
                manhourDashboard.classList.remove('active');
                kppDashboard.classList.remove('active');
                dashboardSelection.style.display = 'flex';
                updateMonthDisplay();
                formatDateRange();
                formatKppDateRange();
                startInactivityTimer();
                // Filter line options based on user permissions
                filterLineOptions();
            } else {
                currentUser = null;
                userPermissions = null;
                hideAutoLogoutWarning();
                showPage('loginPage');
            }
        });
        // Filter line options based on user permissions
        function filterLineOptions() {
            if (userPermissions && userPermissions.accessibleLines) {
                // Filter options di halaman input
                const inputLineOptions = lineSelect.querySelectorAll('option');
                inputLineOptions.forEach(option => {
                    if (option.value && !userPermissions.accessibleLines.includes(option.value)) {
                        option.disabled = true;
                        option.style.display = 'none';
                    }
                });
                // Filter options di filter home page
                const filterLineOptions = filterLine.querySelectorAll('option');
                filterLineOptions.forEach(option => {
                    if (option.value && !userPermissions.accessibleLines.includes(option.value)) {
                        option.disabled = true;
                        option.style.display = 'none';
                    }
                });
                // Filter options di halaman KPP input
                const kppLineOptions = kppLineSelect.querySelectorAll('option');
                kppLineOptions.forEach(option => {
                    if (option.value && !userPermissions.accessibleLines.includes(option.value)) {
                        option.disabled = true;
                        option.style.display = 'none';
                    }
                });
                // Filter options di filter KPP dashboard
                const kppFilterLineOptions = kppFilterLine.querySelectorAll('option');
                kppFilterLineOptions.forEach(option => {
                    if (option.value && !userPermissions.accessibleLines.includes(option.value)) {
                        option.disabled = true;
                        option.style.display = 'none';
                    }
                });
            }
        }
        // Email/password login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            setLoginLoading(true);
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showLoginStatus('', false);
            } catch (error) {
                console.error("Login error: ", error);
                showLoginStatus('Email atau password salah!', true);
            } finally {
                setLoginLoading(false);
            }
        });
        // Logout functions
        async function performLogout() {
            try {
                await signOut(auth);
                hideAutoLogoutWarning();
            } catch (error) {
                console.error("Logout error: ", error);
                showAlert('Error', 'Gagal logout: ' + error.message);
            }
        }
        function logout() {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        }
        homeLogoutBtn.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        inputLogoutBtn.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        kppLogoutBtn.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        profileLogoutBtn.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        profileLogoutBtn2.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        settingsLogoutBtn.addEventListener('click', () => {
            showAlert('Konfirmasi Logout', 'Apakah Anda yakin ingin logout?', performLogout);
        });
        // Auto Logout Event Listeners
        stayLoggedInBtn.addEventListener('click', () => {
            hideAutoLogoutWarning();
            resetInactivityTimer();
        });
        logoutNowBtn.addEventListener('click', () => {
            hideAutoLogoutWarning();
            performLogout();
        });
        // Navigation
        homeNav.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('homePage');
            // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
            manhourDashboard.classList.remove('active');
            kppDashboard.classList.remove('active');
            dashboardSelection.style.display = 'flex';
        });
        inputNav.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data.');
                return;
            }
            resetForm();
            showPage('inputPage');
            // Set today's date as default
            document.getElementById('tanggal').valueAsDate = new Date();
        });
        kppNav.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP.');
                return;
            }
            resetKppForm(); // Reset form saat membuka halaman
            showKppPage();
        });
        profileNav.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('profilePage');
        });
        settingsNav.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('settingsPage');
        });
        // Duplicate navigation for other nav items
        homeNav2.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('homePage');
            // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
            manhourDashboard.classList.remove('active');
            kppDashboard.classList.remove('active');
            dashboardSelection.style.display = 'flex';
        });
        inputNav2.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data.');
                return;
            }
            resetForm();
            showPage('inputPage');
            document.getElementById('tanggal').valueAsDate = new Date();
        });
        kppNav2.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP.');
                return;
            }
            resetKppForm();
            showKppPage();
        });
        profileNav2.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('profilePage');
        });
        settingsNav2.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('settingsPage');
        });
        homeNav3.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('homePage');
            // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
            manhourDashboard.classList.remove('active');
            kppDashboard.classList.remove('active');
            dashboardSelection.style.display = 'flex';
        });
        inputNav3.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data.');
                return;
            }
            resetForm();
            showPage('inputPage');
            document.getElementById('tanggal').valueAsDate = new Date();
        });
        kppNav3.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP.');
                return;
            }
            resetKppForm();
            showKppPage();
        });
        profileNav3.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('profilePage');
        });
        settingsNav3.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('settingsPage');
        });
        homeNav4.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('homePage');
            // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
            manhourDashboard.classList.remove('active');
            kppDashboard.classList.remove('active');
            dashboardSelection.style.display = 'flex';
        });
        inputNav4.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data.');
                return;
            }
            resetForm();
            showPage('inputPage');
            document.getElementById('tanggal').valueAsDate = new Date();
        });
        kppNav4.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP.');
                return;
            }
            resetKppForm();
            showKppPage();
        });
        profileNav4.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('profilePage');
        });
        settingsNav4.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('settingsPage');
        });
        // --- Event Listeners Navigasi KPP ---
        // Tambahkan event listener untuk semua link navigasi KPP yang baru dibuat
        // Contoh untuk satu set, ulangi untuk kppNav2, kppNav3, kppNav4, dan kombinasi lainnya
        kppNavKpp.addEventListener('click', (e) => { // Untuk navigasi di dalam halaman KPP
            e.preventDefault();
            resetKppForm();
            showKppPage();
        });
        homeNavKpp.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('homePage');
            // Sembunyikan dashboard utama dan tampilkan pilihan dashboard
            manhourDashboard.classList.remove('active');
            kppDashboard.classList.remove('active');
            dashboardSelection.style.display = 'flex';
        });
        inputNavKpp.addEventListener('click', (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data Man Hour.');
                return;
            }
            resetForm(); // Reset form Man Hour
            showPage('inputPage');
            document.getElementById('tanggal').valueAsDate = new Date();
        });
        profileNavKpp.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('profilePage');
        });
        settingsNavKpp.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('settingsPage');
        });
        // Month navigation for Manhour Dashboard
        prevMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateMonthDisplay();
            formatDateRange();
            fetchData();
        });
        nextMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateMonthDisplay();
            formatDateRange();
            fetchData();
        });
        // Month navigation for KPP Dashboard
        kppPrevMonth.addEventListener('click', () => {
            currentKppDate.setMonth(currentKppDate.getMonth() - 1);
            updateMonthDisplay();
            formatKppDateRange();
            fetchKppData();
        });
        kppNextMonth.addEventListener('click', () => {
            currentKppDate.setMonth(currentKppDate.getMonth() + 1);
            updateMonthDisplay();
            formatKppDateRange();
            fetchKppData();
        });
        // Input form event listeners
        lineSelect.addEventListener('change', updatePartOptions);
        shiftSelect.addEventListener('change', updateShiftInfo);
        // KPP form event listeners
        kppLineSelect.addEventListener('change', updateKppPartOptions);
        kppPartSelect.addEventListener('change', updateKppProsesOptions);
        kppProsesSelect.addEventListener('change', updateKppItemNGOptions);
        // Settings event listeners
        darkModeToggle.addEventListener('change', toggleDarkMode);
        autoLogoutTime.addEventListener('change', updateLogoutTime);
        savePermissionsBtn.addEventListener('click', saveUserPermissions);
        // Filter event listeners for Manhour
        filterLine.addEventListener('change', () => {
            updateFilterPartOptions();
            renderData(window.fullDataList || []);
        });
        filterPart.addEventListener('change', () => renderData(window.fullDataList || []));
        filterGroup.addEventListener('change', () => renderData(window.fullDataList || []));
        filterShift.addEventListener('change', () => renderData(window.fullDataList || []));
        resetFilterBtn.addEventListener('click', () => {
            filterLine.value = '';
            filterPart.innerHTML = '<option value="">Semua Part</option>';
            filterGroup.value = '';
            filterShift.value = '';
            renderData(window.fullDataList || []);
        });
        // Filter event listeners for KPP
        kppFilterLine.addEventListener('change', () => {
            updateKppFilterPartOptions();
            renderKppData(window.fullKppDataList || []);
        });
        kppFilterPart.addEventListener('change', () => renderKppData(window.fullKppDataList || []));
        kppFilterProses.addEventListener('change', () => renderKppData(window.fullKppDataList || []));
        kppResetFilterBtn.addEventListener('click', () => {
            kppFilterLine.value = '';
            kppFilterPart.innerHTML = '<option value="">Semua Part</option>';
            kppFilterProses.value = '';
            renderKppData(window.fullKppDataList || []);
        });
        // Input form submission
        productionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            // Cek hak akses input
            if (userPermissions && !userPermissions.canInput) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data.');
                return;
            }
            setInputLoading(true);
            showInputStatus('', false);
            // Get form data
            const data = {
                namaLineProduksi: lineSelect.value,
                namaPart: partSelect.value,
                tanggal: document.getElementById('tanggal').value,
                group: document.getElementById('group').value,
                shift: shiftSelect.value,
                sigmaProduksi: parseFloat(document.getElementById('sigmaProduksi').value),
                sigmaOP: parseFloat(document.getElementById('sigmaOP').value),
                loadingTime: parseFloat(document.getElementById('loadingTime').value),
                timestamp: new Date()
            };
            // Cek apakah user memiliki akses ke line produksi ini
            if (userPermissions.accessibleLines && 
                !userPermissions.accessibleLines.includes(data.namaLineProduksi)) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data line produksi ini.');
                setInputLoading(false);
                return;
            }
            try {
                if (documentIdInput.value) {
                    // Update existing document
                    const docRef = doc(db, "produksiData", documentIdInput.value);
                    await updateDoc(docRef, data);
                    console.log("Document successfully updated!");
                    showAlert('Sukses', 'Data berhasil diperbarui!', () => {
                        showPage('homePage');
                        fetchData();
                    });
                } else {
                    // Add new document
                    const docRef = await addDoc(collection(db, "produksiData"), data);
                    console.log("Document written with ID: ", docRef.id);
                    showAlert('Sukses', 'Data berhasil disimpan!', () => {
                        showPage('homePage');
                        fetchData();
                    });
                }
                resetForm();
            } catch (error) {
                console.error("Error saving document: ", error);
                showAlert('Error', 'Gagal menyimpan data: ' + error.message);
            } finally {
                setInputLoading(false);
            }
        });
        // Submit form KPP
        kppForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Cek hak akses input (opsional, bisa dibuatkan permission khusus KPP)
            if (userPermissions && !userPermissions.canInput) {
                 showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP.');
                 return;
            }

            setKppInputLoading(true);
            showKppStatus('', false);

            // Get form data
            const data = {
                namaLineProduksi: kppLineSelect.value,
                namaPart: kppPartSelect.value,
                tanggal: document.getElementById('kppTanggal').value,
                proses: kppProsesSelect.value,
                itemNG: kppItemNGSelect.value,
                jumlahNG: parseInt(document.getElementById('kppJumlahNG').value, 10),
                timestamp: new Date()
                // Tambahkan field lain jika diperlukan, misalnya user input
            };

            // Cek apakah user memiliki akses ke line produksi ini (jika diterapkan)
            if (userPermissions && userPermissions.accessibleLines &&
                !userPermissions.accessibleLines.includes(data.namaLineProduksi)) {
                showAlert('Akses Ditolak', 'Anda tidak memiliki hak akses untuk input data KPP line produksi ini.');
                setKppInputLoading(false);
                return;
            }

            try {
                if (kppDocumentIdInput.value) {
                    // Update existing document (jika fitur edit diperlukan)
                    const docRef = doc(db, "collection_kpp", kppDocumentIdInput.value);
                    await updateDoc(docRef, data);
                    console.log("Document KPP successfully updated!");
                    showAlert('Sukses', 'Data KPP berhasil diperbarui!', () => {
                        showPage('homePage'); // Atau kembali ke halaman KPP jika ada list
                        fetchKppData(); // Refresh data KPP
                    });
                } else {
                    // Add new document
                    const docRef = await addDoc(collection(db, "collection_kpp"), data);
                    console.log("Document KPP written with ID: ", docRef.id);
                    showAlert('Sukses', 'Data KPP berhasil disimpan!', () => {
                         showPage('homePage'); // Atau kembali ke halaman KPP jika ada list
                        fetchKppData(); // Refresh data KPP
                    });
                }
                resetKppForm();
            } catch (error) {
                console.error("Error saving KPP document: ", error);
                showAlert('Error', 'Gagal menyimpan data KPP: ' + error.message);
            } finally {
                setKppInputLoading(false);
            }
        });
        // Delete confirmation
        confirmDeleteBtn.addEventListener('click', deleteData);
        // Dashboard Selection Event Listeners
        manhourDashboardBtn.addEventListener('click', (e) => {
            e.preventDefault();
            dashboardSelection.style.display = 'none';
            manhourDashboard.classList.add('active');
            kppDashboard.classList.remove('active');
            fetchData(); // Load data for manhour dashboard
        });
        kppDashboardBtn.addEventListener('click', (e) => {
            e.preventDefault();
            dashboardSelection.style.display = 'none';
            kppDashboard.classList.add('active');
            manhourDashboard.classList.remove('active');
            fetchKppData(); // Load data for KPP dashboard
        });
        // Initialize
        updateMonthDisplay();
        formatDateRange();
        formatKppDateRange();
        loadSettings();
        updateFilterPartOptions();
        updateKppFilterPartOptions();
        generateLineAccessCheckboxes();
        // --- Inisialisasi ---
        // Set default date for KPP form
        document.getElementById('kppTanggal').valueAsDate = new Date();
    </script>
    <!-- Bootstrap JS (needed for modal) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
